{
  "column_mappings": {
    "identifiers": {
      "lab_id": {
        "source_patterns": ["^numéro$", "^numero$", "^num[eé]ro$", "id.*lab"],
        "type": "identifier",
        "required": true,
        "description": "Laboratory ID number"
      },
      "barcode": {
        "source_patterns": ["code.*barres.*kps", "code_barres_kps", "barcode", "code.*barr"],
        "type": "identifier",
        "required": true,
        "description": "KPS barcode"
      }
    },
    
    "study_info": {
      "study": {
        "source_patterns": ["^etude$", "^étude$", "study"],
        "type": "categorical",
        "required": true,
        "valid_values": {
          "DA": ["DA", "ACTIF", "ACTIVE", "D.A"],
          "DP": ["DP", "PASSIF", "PASSIVE", "D.P"]
        },
        "description": "Study type (DA=Active, DP=Passive)"
      }
    },
    
    "location": {
      "health_facility": {
        "source_patterns": ["structure.*sanitaire", "unité.*mobile", "health.*facility"],
        "type": "text",
        "required": false,
        "description": "Health facility or mobile unit"
      },
      "health_zone": {
        "source_patterns": ["zone.*santé", "zone.*sante", "health.*zone", "^zone$"],
        "type": "text",
        "required": true,
        "description": "Health zone"
      },
      "province": {
        "source_patterns": ["^province$"],
        "type": "text",
        "required": true,
        "valid_values": ["KASAI-ORIENTAL", "KASAI", "LOMAMI", "SANKURU"],
        "description": "Province"
      }
    },
    
    "dates": {
      "date_sample": {
        "source_patterns": ["date.*prélèvement", "date.*prelevement", "date.*collection", "sample.*date"],
        "type": "date",
        "required": true,
        "format_hints": ["DD/MM/YYYY", "DD-MM-YYYY", "YYYY-MM-DD", "Excel serial"],
        "description": "Sample collection date"
      },
      "date_sent_cpltha": {
        "source_patterns": ["date.*envoi.*vers.*cpltha", "date.*envoi.*cpltha", "sent.*cpltha"],
        "type": "date",
        "required": false,
        "description": "Date sent to CPLTHA"
      },
      "date_received_cpltha": {
        "source_patterns": ["date.*réception.*cpltha", "date.*reception.*cpltha", "received.*cpltha"],
        "type": "date",
        "required": false,
        "description": "Date received at CPLTHA"
      },
      "date_sent_inrb": {
        "source_patterns": ["date.*envoi.*inrb", "date.*inrb", "sent.*inrb"],
        "type": "date",
        "required": false,
        "description": "Date sent to INRB"
      }
    },
    
    "demographics": {
      "age": {
        "source_patterns": ["age.*année.*naissance", "age.*annee.*naissance", "^age$", "birth.*year"],
        "type": "age",
        "required": false,
        "valid_range": [0, 120],
        "description": "Age in years or birth year"
      },
      "sex": {
        "source_patterns": ["^sexe", "sex.*m.*f", "gender"],
        "type": "categorical",
        "required": false,
        "valid_values": {
          "M": ["M", "MALE", "HOMME", "H", "MASCULIN"],
          "F": ["F", "FEMALE", "FEMME", "FEMININ"]
        },
        "description": "Biological sex"
      }
    },
    
    "case_history": {
      "previous_case": {
        "source_patterns": ["ancien.*cas", "previous.*case", "old.*case"],
        "type": "categorical",
        "required": false,
        "valid_values": {
          "Oui": ["OUI", "YES", "Y", "O", "1"],
          "Non": ["NON", "NO", "N", "0"],
          "Incertain": ["INCERTAIN", "UNCERTAIN", "?", "UNKNOWN", "UNK"]
        },
        "description": "Previous HAT case"
      },
      "treated": {
        "source_patterns": ["^traité", "^traite", "treated", "treatment"],
        "type": "categorical",
        "required": false,
        "valid_values": {
          "Oui": ["OUI", "YES", "Y", "O", "1"],
          "Non": ["NON", "NO", "N", "0"],
          "Incertain": ["INCERTAIN", "UNCERTAIN", "?", "UNKNOWN", "UNK"]
        },
        "description": "Previously treated for HAT"
      }
    },
    
    "storage_conditions": {
      "storage_before_cpltha": {
        "source_patterns": ["stockage.*avant.*cpltha", "storage.*before", "pre.*storage"],
        "type": "categorical",
        "required": false,
        "valid_values": {
          "Ambiante": ["A", "AMB", "AMBIANTE", "AMBIENT", "ROOM", "RT"],
          "Frigo": ["F", "FRIGO", "FRIDGE", "REFRIGERATOR", "2-8", "4°C"],
          "Congelateur": ["C", "CONG", "CONGELATEUR", "FREEZER", "-20", "-80"]
        },
        "description": "Storage temperature before CPLTHA"
      },
      "transport_temperature": {
        "source_patterns": ["température.*transport", "temperature.*transport", "temp.*transport"],
        "type": "categorical",
        "required": false,
        "valid_values": {
          "Ambiante": ["A", "AMB", "AMBIANTE", "AMBIENT", "ROOM"],
          "Frigo": ["F", "FRIGO", "FRIDGE", "COLD"],
          "Congelateur": ["C", "FROZEN", "CONGELATEUR"]
        },
        "description": "Temperature during transport"
      },
      "storage_temp_cpltha": {
        "source_patterns": ["température.*stockage.*cpltha", "temperature.*stockage.*cpltha", "cpltha.*storage.*temp"],
        "type": "categorical",
        "required": false,
        "valid_values": {
          "Ambiante": ["A", "AMB", "AMBIANTE", "AMBIENT"],
          "Frigo": ["F", "FRIGO", "FRIDGE"],
          "Congelateur": ["C", "CONG", "CONGELATEUR", "FREEZER"]
        },
        "description": "Storage temperature at CPLTHA"
      }
    },
    
    "sample_types": {
      "has_drs": {
        "source_patterns": ["présence.*drs", "presence.*drs", "drs.*present"],
        "type": "boolean",
        "required": false,
        "valid_values": {
          "true": ["OUI", "YES", "Y", "1", "TRUE"],
          "false": ["NON", "NO", "N", "0", "FALSE"]
        },
        "description": "DRS sample present"
      },
      "has_dbs": {
        "source_patterns": ["présence.*dbs", "presence.*dbs", "dbs.*present"],
        "type": "boolean",
        "required": false,
        "valid_values": {
          "true": ["OUI", "YES", "Y", "1", "TRUE"],
          "false": ["NON", "NO", "N", "0", "FALSE"]
        },
        "description": "DBS sample present"
      },
      "dbs_count": {
        "source_patterns": ["nombre.*dbs", "number.*dbs", "dbs.*count", "n.*dbs"],
        "type": "numeric",
        "required": false,
        "valid_range": [0, 10],
        "description": "Number of DBS cards"
      }
    },
    
    "metadata": {
      "responsible_person": {
        "source_patterns": ["responsable.*structure", "responsable.*cpltha", "responsible", "contact.*person"],
        "type": "text",
        "required": false,
        "description": "Responsible person at facility"
      },
      "contact": {
        "source_patterns": ["^contact$", "phone", "telephone"],
        "type": "text",
        "required": false,
        "description": "Contact information"
      },
      "remarks": {
        "source_patterns": ["^remarques$", "^remarks$", "comments", "notes"],
        "type": "text",
        "required": false,
        "description": "Additional remarks or notes"
      }
    }
  },
  
  "data_quality_rules": {
    "row_validation": {
      "require_both_ids": {
        "description": "Both lab_id and barcode must be present",
        "severity": "critical"
      },
      "require_sample_date": {
        "description": "Sample date must be present and valid",
        "severity": "critical"
      },
      "age_range": {
        "description": "Age must be between 0 and 120",
        "severity": "warning"
      },
      "date_sequence": {
        "description": "Dates must be in logical sequence: sample < sent_cpltha < received_cpltha < sent_inrb",
        "severity": "warning"
      }
    },
    
    "transport_thresholds": {
      "field_to_cpltha_max": {
        "value": 30,
        "unit": "days",
        "description": "Maximum days from field to CPLTHA"
      },
      "cpltha_to_inrb_max": {
        "value": 90,
        "unit": "days",
        "description": "Maximum days from CPLTHA to INRB"
      },
      "total_transport_max": {
        "value": 365,
        "unit": "days",
        "description": "Maximum total transport time"
      }
    }
  },
  
  "derived_fields": {
    "transport_field_to_cpltha": {
      "formula": "date_sent_cpltha - date_sample",
      "unit": "days",
      "description": "Days from sample collection to shipment to CPLTHA"
    },
    "transport_cpltha_to_inrb": {
      "formula": "date_sent_inrb - date_received_cpltha",
      "unit": "days",
      "description": "Days from CPLTHA reception to INRB shipment"
    },
    "conservation_days": {
      "formula": "coalesce(date_sent_inrb, date_received_cpltha) - date_sample",
      "unit": "days",
      "description": "Total conservation time (proxy for treatment date)"
    },
    "case_category": {
      "logic": {
        "Previous/Treated": "previous_case == 'Oui' OR treated == 'Oui'",
        "New case": "previous_case == 'Non' AND treated == 'Non'",
        "Uncertain": "previous_case == 'Incertain' OR treated == 'Incertain'",
        "Unknown": "default"
      },
      "description": "Categorized case status"
    }
  },
  
  "metadata": {
    "version": "2.0.0",
    "last_updated": "2024-01-20",
    "author": "Biobank Dashboard Team",
    "description": "Column mapping configuration for Mbuji-Mayi Biobank Excel files"
  }
}
